---
layout: post
title: n2bd - tcp
tag: archived
---

{{ page.title }}
================

<p class="meta">19 August 2020 - Istanbul</p>

welcome to the second post on **note to backend developer (n2bd)** series. today we are gonna talk about tcp: the well known old friend. all of the notes are taken after studying a related chapter of the second edition of [computer networks and internets](https://www.amazon.com/gp/product/B00I7YV2NA/ref=dbs_a_def_rwt_hsch_vapi_tkin_p1_i2). in addition to that [why does tcp need a 3-way handshake anyway](https://pcarleton.com/2018/06/06/why-does-tcp-need-a-3-way-handshake-anyway/) blog post also help me understand the some open points.

**tcp** means transmission control protocol which is a transport layer protocol that provides reliability. 

**the need for reliable transport**: most of the time we are thinking reliability as a fundamental in a computer system. while we are dealing with external devices like printer, we just send data to the device, but does not verify the process, if there is any loss/duplication or not. tcp provides all the necessary features for internet communication in that manner.

* **connection orientation** 
    - an application needs to request connection, then uses this connection to send data.
* **point to point communication**
    - each connection has exactly two endpoints
* **complete reliability**
    - the data will be delivered exactly as sent with no missing or out of order.
* **full duplex communication**
* **stream interface**
* **reliable connection startup**
* **graceful connection shutdown**

all the connections are achieved in software by tcp known as **virtual connection**

tcp treats ip as a packet carrier, ip treats tcp message as data payload.

## **achieving reliability**

**packet loss and retransmission**

when tcp receives data, it sends an acknowledgment back to the sender. tcp waits a while and if there is no acknowledgement the sender retransmits the data.

**how long should it wait?**

tcp doesn't care if we are sending our data over lan(local area network) or over long-distance satellite. since this is the case, a predefined timeout is a problem. if it's too short you may send too many packages and if it's too long you may cause a huge unnecessary delay.

**adaptive retransmission**

as a solution to a predefined timeout problem. tcp monitors the current delay on each connection to adapt its timeout. tcp adjust the timeout to a value greater than the mean of delays to accommodate peaks. what tcp wants to achieve is to determine if the packet is lost without waiting too much.

**window mechanism**

when a connection established both sides allocate a buffer to hold data and sends the size of the remaining buffer the other hand. the available buffer size at any time is called as **window**

**3-way handshake**

SYN, ACKSYN, ACK messages are exchanged between two endpoints to ensure reliability.

1 - SYN message will be sent by the sender. it contains a sequence number of the sender.
2 - ACKSYN message will be sent by the receiver. it contains a sender's sequence number+1 for ACK and sequence number of receiver for SYN.
3 - SYN message will be sent by the sender. it contains the receiver's sequence number+1.

**what is sequence number**
it's a tag for payload. it's randomly selected then increments sequentially. the reason for this randomness is to prevent interference of slow packets from a previous connection and making spoofing attacks more difficult than predefined sequence number version. since the sequence number is a tag for payload we can keep track of the packages and immediately know if there is any lost or duplicate one.

**how tcp does congestion control?**
as we know tcp retransmit data if there is no ACK within a reasonable time. but if there is too many retransmission this can cause congestion which may result in more packet loss

on the other hand, most of the packet lost is related to congestion instead of hardware failure. because of that if there is a packet lost tcp assumes the reason is congestion. for preventing that instead of retransmitting enough data to fill the receiver's window size, tcp begins sending a single message to make packages smaller, and if it sees acknowledgement from the receiver it doubles the data until data size equal to half of the receiver's window size. then it starts to reduce the rate of increase.

**note to backend developer (n2bd)** series:

- [n2bd - processes](https://www.cagataytanyildiz.com/2020/08/15/n2bd-processes.html)
- [n2bd - tcp](https://www.cagataytanyildiz.com/2020/08/19/n2bd-tcp.html)